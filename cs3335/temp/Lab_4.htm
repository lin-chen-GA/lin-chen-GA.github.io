<!DOCTYPE html>
<html>
	<head>
		<title>C</title>
		<link rel="stylesheet" href="../../css/atelier-sulphurpool-light.css" type="text/css">
		<script src="../../js/google-code-prettify/run_prettify.js?autoload=true&amp;lang=css"></script>
		<style>
			div.title {color: navy; font-weight: bold; width: 80%; font-size: 32px; text-align: center; position: relative; margin: auto;}
			div.subtitle {color: navy; font-weight: bold; width: 80%; font-size: 24px; text-align: position: relative; margin: auto;}
			div.block {color: navy; font-weight: bold; width: 80%; border-style: solid; padding: 5px; position: relative; margin: 10px auto; border-radius: 5px;}
			span {color: red; font-weight: bold;}
		</style>
	</head>
	<body>
		<div class = "title">
			Lab 4: Makefile basic
		</div>

		<div class = "subtitle">Why Makefile</div>
		<div class = "block">
			<li>A makefile is useful because (if properly defined) allows recompiling only what is needed when you make a change</li>
		<pre class = "prettyprint linenums">
gcc main.c util.c // if a file is changed, all files will be recompiled
		</pre>
		</div>
		<div class = "subtitle">Sample Code</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// util.h
#ifndef UTIL_H
#define UTIL_H

void disp();

#endif
		</pre>
		<pre class = "prettyprint linenums">
// util.c
#include &lt;stdio.h&gt;
#include "util.h"

void disp()
{
	printf("Hello World!\n");
}
		</pre>
		<pre class = "prettyprint linenums">
// main.c
#include "util.h"

int main()
{
	disp();

	return 0;
}
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// compile commands
gcc -c util.c main.c // compile
gcc -o hello util.o main.o // link
		</pre>
		</div>
		<div class = "block">
			<p style = "text-align:center;"><img src = "../img/CS3335_12.png" width = "60%"></p>
		</div>
		<div class = "subtitle">Syntax</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
target: prerequisites
	command
		</pre>
		<li>target is object file, executable file, or a label</li>
		<li>prerequisites are the files or targets to generate target</li>
		<li>command is the commands will be implemented by make</li>
		</div>
		<div class = "subtitle">Makefile</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# makefile
hello: main.o util.o
	gcc -o hello main.o util.o
main.o: main.c util.h
	gcc -c main.c
util.o: util.c util.h
	gcc -c util.c
clean:
	rm main.o util.o hello
		</pre>
		</div>
		<div class = "subtitle">Knowledge Points</div>
		<div class = "block">
			<li>make target
				<ul>
					<li>Recursively check if the prerequisites</li>
					<li>Run the commands of the target</li>
				</ul>
			</li>
			<li><span>make</span>
				<ul>
					<li>equals to <span>make hello</span></li>
					<li>recurively check the prerequisites and generate executable hello</li>
				</ul>
			</li>
			<li><span>make clean</span>
				<ul>
					<li>Has no prerequisites, does not implemented automatically when run make command</li>
					<li>remove main.o, util.o and hello files</li>
				</ul>
			</li>
			<li>Indentation use <span>"Tab"</span> instead of spaces</li>
		</div>
		<div class = "subtitle">Write a C program and Makefile</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// main.c
#include &lt;stdio.h&gt;
#include "io.h"
#include "util.h"

int main()
{
	int num = read_num();
	if(is_prime(num)
		printf("%d is prime\n", num);
	else
		printf("%d is not prime\n", num);

	return 0;
}
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// io.h
#ifndef IO_H
#define IO_H

int read_num(); // read a positive integer number

#endif
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// util.h
#ifndef UTIL_H
#define UTIL_H
#include &lt;stdbool.h&gt;

bool is_prime(int n); // check whether an integer is prime or not

#endif
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// io.c
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// util.c
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# Makefile
		</pre>
		</div>
		<div class = "subtitle">Grading Criteria</div>
		<div class = "block">
			<li>The program can be compiled with the makefile (40%)</li>
			<li>The program can generate the expected results (40%)</li>
			<li>Code organization (10%)</li>
			<li>The *.o and generated executable files can be removed by "make clean" (10%)</li>
		</div>
	</body>
</html>
