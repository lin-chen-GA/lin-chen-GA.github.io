<!DOCTYPE html>
<html>
	<head>
		<title>C</title>
		<link rel="stylesheet" href="../css/atelier-sulphurpool-light.css" type="text/css">
		<script src="../js/google-code-prettify/run_prettify.js?autoload=true&amp;lang=css"></script>
		<style>
			div.title {color: navy; font-weight: bold; width: 80%; font-size: 32px; text-align: center; position: relative; margin: auto;}
			div.subtitle {color: navy; font-weight: bold; width: 80%; font-size: 24px; text-align: position: relative; margin: auto;}
			div.block {color: navy; font-weight: bold; width: 80%; border-style: solid; padding: 5px; position: relative; margin: 10px auto; border-radius: 5px;}
			span {color: red; font-weight: bold;}
		</style>
	</head>
	<body>
		<div class = "title">
			cmake
		</div>

		<div class = "subtitle">Genearte Makefile</div>
		<div class = "block">
			<p style = "text-align:center;"><img src = "img/CS3335_34.png" width = "40%"></p>
		</div>
		<div class = "subtitle">CMake Syntax</div>
		<div class = "block">
			<li>#, comment</li>
			<li>${var}, access value defined in the variable "var"</li>
		</div>
		<div class = "subtitle">CMake Directory Variables</div>
		<div class = "block">
			<li><span>CMAKE_SOURCE_DIR</span>, the directory that contains the top-level CMakeLists.txt file</li>
			<li><span>CMAKE_CURRENT_SOURCE_DIR</span>, the directory containing the CMakeLists.txt file that is currently being processed</li>
			<li><span>CMAKE_BINARY_DIR</span>, the path to the top level of the build tree</li>
			<li><span>CMAKE_CURRENT_BINARY_DIR</span>, the path to the binary directory currently being processed</li>
			<li><span>PROJECT_SOURCE_DIR</span>, top level source directory for the current project</li>
			<li><span><i>projectName</i>_SOURCE_DIR</span>, source directory for the named project</li>
			<li><span>PROJECT_BINARY_DIR</span>, top level binary directory for the current project</li>
			<li><span><i>projectName_BINARY_DIR</i></span>, binary directory for the named project</li>
			<li><span>CMAKE_C_COMPILER</span>, C compiler</li>
			<li><span>CMAKE_CXX_COMPILTER</span>, C++ compiler</li>
			<li><span>CMAKE_C_FLAGS</span>, C flags</li>
			<li><span>CMAKE_CXX_FLAGS</span>, C++ flags</li>
			<li><span>EXECUTABLE_OUTPUT_PATH</span>, output path for executable program</li>
			<li><span>LIBRARY_OUTPUT_PATH</span>, output path for libraries</li>
			<li><span>CMAKE_BUILD_TYPE</span>, figure out build type, [Debug|Release]</li>
			<li><span>BUILD_SHARED_LIBS</span>, figure out library build model, [OFF|ON]</li>
		</div>
		<div class = "subtitle">Functions</div>
		<div class = "block">
			<li><span>cmake_minimum_required(VERSION major.minor)</span>, set the minimum required version of cmake</li>
			<li><span>project(name, version, language)</span>, set a name, version, and enable languages for the entire project</li>
			<li><span>aux_source_directory(dir, var)</span>, collects the names of all the source files in the specified directory and stores the list in the "var" provided, "var" should be <span>unique</span></li>
			<li><span>add_library(libName, [STATIC|SHARED|MODULE], source)</span>
				<ul>
					<li>libName, corresponds to the logical target name and must be globally <span>unique</span> within a project</li>
					<li>STATIC libraries are archives of object files</li>
					<li>SHARED libraries are linked dynamically and loaded at runtime</li>
				</ul>
			</li>
			<li><span>add_executable(name, source)</span>, add an executable to the project using the specified source files</li>
			<li><span>add_subdirectory(dir)</span>, add a subdirectory to the build</li>
			<li><span>include_directories(dir)</span>, add the given directories to those the compiler uses to search for include files, relative paths are interpreted as relative to the current source directory, affects directory scope, <span>all targets</span> in this CMakeList, as well as those in <span>all subdirectories</span> added after the point of its call</li>
			<li><span>target_include_directories(target, INTERFACE|PUBLIC|PRIVATE, dir)</span>, specify include directories or targets to use when compiling a given target</li>
			<li><span>set(variable, value)</span>, set a CMake, cache or environment variable to a given value</li>
			<li><span>file(GLOB variable value)</span>, GLOB will generate a list of all files that match the globbing expressions and store it into the variable</li>
			<li><span>file(GLOB_RECURSE variable value)</span>, traverse all the subdirectories of the matched directory and match the files</li>
			<li><span>find_library(variable libName)</span>, this command is used to find a library</li>
			<li><span>target_link_libraries(target libName)</span>, specify libraries or flags to use when linking a given target, cmake like to use full path of libraries</li>
			<li><span>message("Code: " ${c_files})</span>, print information</li>
		</div>
		<div class = "subtitle">Example 1</div>
		<div class = "block">
			<p style = "text-align:center;"><img src = "img/cmake_1.png" width = "40%"></p>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// main.c
#include &lt;stdio.h&gt;

int main()
{
	printf("Hello World!\n");

	return 0;
}
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# CMakeLists.txt 1
cmake_minimum_required (VERSION 2.6)
project (Hello)
add_subdirectory(src)
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# CMakeLists.txt 2
add_executable(Hello main.c)
		</pre>
		</div>
		<div class = "block">
			<li>cd build</li>
			<li>cmake ..</li>
			<li>make, generate executable file "Hello" in build/src</li>
		</div>
		<div class = "subtitle">Example 2</div>
		<div class = "block">
			<p style = "text-align:center;"><img src = "img/CS3335_35.png" width = "40%"></p>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// util.h
#ifndef UTIL_H
#define UTIL_H

void hello();
void world();
void disp();

#endif
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// hello.c
#include &lt;stdio.h&gt;
#include "util.h"

void hello()
{
	printf("Hello ");
}
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// util.c
#include &lt;stdio.h&gt;
#include "util.h"

void disp()
{
	hello();
	world();
}
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// world.c
#include &lt;stdio.h&gt;
#include "util.h"

void world()
{
	printf("World!\n");
}
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
// main.c
#include &lt;util.h&gt;
#include "util.h"

int main()
{
	disp();

	return 0;
}
		</pre>
		</div>
		<div class = "subtitle">Version 1</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# CMakeLists.txt 1
cmake_minimum_required(VERSION 2.6)

project(c1)

include_directories(${PROJECT_SOURCE_DIR}/include) # add before adding subdirectory
add_subdirectory (src)
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# CMakeLists.txt 2
add_executable(Hello main.c hello.c util.c world.c)
		</pre>
		</div>
		<div class = "subtitle">Version 2</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# CMakeLists.txt 1
cmake_minimum_required(VERSION 2.6)

project(c1)

include_directories(${PROJECT_SOURCE_DIR}/include) # add before adding subdirectory
add_subdirectory (src)
		</pre>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# CMakeLists.txt 2
aux_source_directory(. SRC_LIST) # collect source files in the current directory and save them into a variable SRC_LIST
add_executable(Hello ${SRC_LIST})
		</pre>
		</div>
		<div class = "block">
			<li>cd build</li>
			<li>cmake ..</li>
			<li>make, generate executable file "Hello" in build, generate libmylib.a in build/src</li>
		</div>
		<div class = "subtitle"><span>Exercise 1</span></div>
		<div class = "block">
			<li>Find the solution for Lab 5</li>
			<li>Generate makefile for Lab 5 with cmake</li>
			<li>Compile the code with the generated makefile</li>
		</div>
		<div class = "subtitle">Publish</div>
		<div class = "block">
			<li>Write README.m with <a href = "https://daringfireball.net/projects/markdown/syntax">markdown</a></li>
			<li><a href = "https://choosealicense.com/">Choose license</a></li>
		</div>
		<div class = "block">
			<p style = "text-align:center;"><img src = "img/CS3335_36.png" width = "40%"></p>
		</div>
		<div class = "block">
		<pre class = "prettyprint linenums">
# CMakeLists.txt 1
cmake_minimum_required(VERSION 2.6)

project(c1)

# setup the directory of saving the executable program
set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/build/bin)

# setup the directory of include folder
include_directories(${PROJECT_SOURCE_DIR}/include)

# setup the directory of src folder
add_subdirectory (src)

# copy README.md to install folder
file(COPY ${PROJECT_SOURCE_DIR}/README.md DESTINATION ${CMAKE_INSTALL_PREFIX})

# copy LICENSE to install folder
file(COPY ${PROJECT_SOURCE_DIR}/LICENSE DESTINATION ${CMAKE_INSTALL_PREFIX})
		</pre>
		<pre class = "prettyprint linenums">
# CMakeLists.txt 2
aux_source_directory(. SRC_LIST)
add_executable(Hello ${SRC_LIST})

# install executable program
INSTALL(TARGETS Hello
	RUNTIME DESTINATION bin)

# install header files
INSTALL(DIRECTORY ${PROJECT_SOURCE_DIR}/include/ DESTINATION include)
		</pre>
		</div>
		<div class = "block">
			<li>cd build</li>
			<li>cmake -DCMAKE_INSTALL_PREFIX=$HOME/.local ..</li>
			<li>make</li>
			<li>make install</li>
			<li>xargs rm &lt;  install_manifest.txt, uninstall</li>
		</div>
		<div class = "subtitle">Reference</div>
		<div class = "block">
			<li><a href = "https://www.ibm.com/developerworks/cn/linux/l-cn-cmake/">IBM Tutorial</a></li>
			<li><a href = "https://cmake.org/cmake/help/v3.0/index.html">Documentation</a></li>
			<li><a href = "https://www.jianshu.com/p/8df5b2aba316">Brief Tutorial</a></li>
		</div>
	</body>
</html>
